# 检查数据保存问题 - 排查指南

## 🔍 问题：创建了信息但没有保存到数据库

### 可能的原因：

1. **Supabase表不存在**
   - 错误代码：`PGRST116` 或 `42P01`
   - 解决：在Supabase Dashboard中执行 `supabase_schema_simple.sql`

2. **数据格式不匹配**
   - 某些字段类型不匹配
   - 解决：检查字段类型

3. **权限问题**
   - RLS策略阻止了插入
   - 解决：检查Supabase的RLS设置

4. **网络问题**
   - 请求失败
   - 解决：检查网络连接

## 🔧 排查步骤

### 步骤1：检查浏览器控制台

创建客户后，查看控制台是否有：
- ✅ `✅ 已保存到Supabase` - 说明保存成功
- ❌ `❌ 保存到Supabase失败` - 说明保存失败，查看错误详情

### 步骤2：检查Supabase表是否存在

在浏览器控制台执行：

```javascript
const supabase = window.supabase.createClient(
  'https://jpaurpkibrjwqthrcexc.supabase.co',
  'sb_publishable_eJMFki07-yqFP8Hv2kdu9g_7lrSRdBB'
);

// 检查表是否存在
supabase.from('customers').select('count').limit(1)
  .then(({ data, error }) => {
    if (error) {
      if (error.code === 'PGRST116' || error.code === '42P01') {
        console.log('❌ customers表不存在！');
        console.log('请在Supabase Dashboard中执行: supabase_schema_simple.sql');
      } else {
        console.error('错误:', error);
      }
    } else {
      console.log('✅ customers表存在');
    }
  });
```

### 步骤3：在Supabase Dashboard中检查

1. 打开 Supabase Dashboard
2. 进入 Table Editor
3. 查看 `customers` 表
4. 检查是否有新创建的数据

### 步骤4：测试手动插入

在浏览器控制台执行：

```javascript
const supabase = window.supabase.createClient(
  'https://jpaurpkibrjwqthrcexc.supabase.co',
  'sb_publishable_eJMFki07-yqFP8Hv2kdu9g_7lrSRdBB'
);

// 测试插入
supabase.from('customers').insert([{
  customer_name: '测试客户_' + Date.now(),
  company_name: '测试公司',
  category: '公海',
  status: '公海'
}]).select().single()
  .then(({ data, error }) => {
    if (error) {
      console.error('❌ 插入失败:', error);
      console.error('错误代码:', error.code);
      console.error('错误消息:', error.message);
    } else {
      console.log('✅ 插入成功:', data);
    }
  });
```

## 📊 常见错误及解决方案

### 错误1: `relation "customers" does not exist` (PGRST116)

**原因**: 表还未创建

**解决**: 
1. 打开 Supabase Dashboard
2. 进入 SQL Editor
3. 执行 `supabase_schema_simple.sql`

### 错误2: `new row violates row-level security policy`

**原因**: RLS策略阻止了插入

**解决**: 
1. 在Supabase Dashboard中，进入 Table Editor
2. 选择 `customers` 表
3. 点击 "Policies" 标签
4. 检查或禁用RLS策略（如果是测试环境）

### 错误3: `column "xxx" does not exist`

**原因**: 表结构不匹配

**解决**: 
1. 检查表结构
2. 执行 `supabase_clean_and_create.sql` 重新创建表

## 🎯 快速诊断

执行以下代码查看详细错误：

```javascript
// 在浏览器控制台执行
const supabase = window.supabase.createClient(
  'https://jpaurpkibrjwqthrcexc.supabase.co',
  'sb_publishable_eJMFki07-yqFP8Hv2kdu9g_7lrSRdBB'
);

// 测试插入
supabase.from('customers').insert([{
  customer_name: '测试',
  company_name: '测试公司',
  category: '公海'
}]).select().single()
  .then(({ data, error }) => {
    console.log('结果:', { data, error });
    if (error) {
      console.error('完整错误对象:', error);
    }
  });
```

## 📝 下一步

1. 查看浏览器控制台的错误信息
2. 告诉我具体的错误代码和消息
3. 我会帮您解决

