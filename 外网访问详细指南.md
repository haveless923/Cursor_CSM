# CSM 系统外网访问详细指南

## 🎯 问题说明

如果你的同事在不同的网络环境下（比如在家办公、不同办公室、不同城市等），需要通过**外网**访问你的本地服务器。

## 🚀 推荐方案：使用内网穿透

### 方案A：使用 Cloudflare Tunnel（最简单，免费）⭐

**优点**：
- ✅ 完全免费
- ✅ 无需注册账号
- ✅ 无需公网IP
- ✅ 自动HTTPS加密

**步骤**：

1. **安装 cloudflared**：
   ```bash
   brew install cloudflared
   ```

2. **确保本地服务正在运行**：
   ```bash
   cd /Users/bonnie/CSM_Cursor
   npm run dev
   ```

3. **启动内网穿透（前端）**：
   打开新的终端窗口，运行：
   ```bash
   cloudflared tunnel --url http://localhost:3000
   ```
   
   会显示类似这样的地址：
   ```
   https://xxxx-xx-xx-xx-xx.trycloudflare.com
   ```
   
   **将这个地址告诉同事！**

4. **启动内网穿透（后端）**：
   再打开一个终端窗口，运行：
   ```bash
   cloudflared tunnel --url http://localhost:3001
   ```
   
   会显示另一个地址，例如：
   ```
   https://yyyy-yy-yy-yy-yy.trycloudflare.com
   ```

5. **配置前端使用后端地址**：
   - 在浏览器中访问前端地址（步骤3的地址）
   - 打开浏览器控制台（F12）
   - 在控制台运行：
     ```javascript
     localStorage.setItem('backend_url', 'https://yyyy-yy-yy-yy-yy.trycloudflare.com');
     location.reload();
     ```
   - 或者告诉同事也这样做

6. **完成！** 现在同事可以通过前端地址访问系统了。

---

### 方案B：使用 ngrok（需要注册，但更稳定）

**优点**：
- ✅ 稳定可靠
- ✅ 可以配置固定域名（付费）
- ✅ 有管理面板

**步骤**：

1. **安装 ngrok**：
   ```bash
   brew install ngrok
   ```

2. **注册账号**：
   - 访问 https://ngrok.com/
   - 注册免费账号
   - 获取 authtoken

3. **配置 ngrok**：
   ```bash
   ngrok config add-authtoken 你的token
   ```

4. **创建配置文件** `ngrok.yml`：
   ```yaml
   version: "2"
   authtoken: 你的token
   tunnels:
     frontend:
       addr: 3000
       proto: http
     backend:
       addr: 3001
       proto: http
   ```

5. **启动两个隧道**：
   ```bash
   # 终端1 - 前端
   ngrok http 3000
   
   # 终端2 - 后端
   ngrok http 3001
   ```

6. **获取地址并配置**：
   - 前端地址：告诉同事访问
   - 后端地址：配置到前端（同方案A的步骤5）

---

## 📝 简化操作：使用启动脚本

我已经为你创建了启动脚本：

```bash
chmod +x 启动外网访问.sh
./启动外网访问.sh
```

或者使用 ngrok 版本：

```bash
chmod +x 使用ngrok启动外网访问.sh
./使用ngrok启动外网访问.sh
```

---

## 🔧 自动配置后端地址（推荐）

为了更方便，我已经修改了代码，可以自动检测。但如果使用内网穿透，建议：

1. **访问前端地址后**，在浏览器控制台运行：
   ```javascript
   localStorage.setItem('backend_url', '你的后端ngrok/cloudflare地址');
   location.reload();
   ```

2. **或者修改代码**：编辑 `client/src/services/api.ts`，在 `getApiBaseUrl()` 函数中直接设置后端地址。

---

## ⚠️ 重要提示

1. **服务必须运行**：你的电脑上必须运行 `npm run dev`
2. **内网穿透必须运行**：cloudflared 或 ngrok 必须保持运行
3. **地址会变化**：
   - Cloudflare Tunnel：每次启动地址都会变化（免费版）
   - ngrok：免费版地址也会变化，付费版可以固定
4. **安全性**：内网穿透地址是公开的，建议：
   - 不要分享给不相关的人
   - 定期更换地址
   - 考虑添加密码保护

---

## 🌐 长期方案：部署到云服务器

如果长期使用，建议部署到云服务器：

1. **购买云服务器**（阿里云、腾讯云、AWS等）
2. **部署代码**
3. **配置域名**
4. **所有人通过域名访问**

需要我帮你准备部署方案吗？

---

## 📞 快速开始

**最简单的步骤**：

1. 安装 cloudflared：`brew install cloudflared`
2. 启动本地服务：`npm run dev`
3. 新终端运行：`cloudflared tunnel --url http://localhost:3000`
4. 将显示的地址告诉同事
5. 再开一个终端运行：`cloudflared tunnel --url http://localhost:3001`
6. 在前端页面控制台设置后端地址（见上方步骤5）

**完成！** 🎉




